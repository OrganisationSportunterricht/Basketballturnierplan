<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Basketballturnier – Ergebnisse & Tabelle</title>
  <style>
    :root{
      --bgA:#fff1f2;   /* rose */
      --bgB:#ecfeff;   /* cyan */
      --bgC:#fefce8;   /* yellow */
      --bgD:#eef2ff;   /* indigo */

      --card:#ffffff;
      --ink:#0f172a;
      --muted:#5b6b86;
      --line:#dbe4f0;

      --accent:#2563eb;
      --accent2:#7c3aed;
      --accent3:#f97316;
      --accent4:#06b6d4;

      --good:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;

      --shadow: 0 14px 30px rgba(2,6,23,.10);
      --radius: 16px;
    }

    *{box-sizing:border-box}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;
      margin:0;
      background:
        radial-gradient(900px 420px at 10% 0%, var(--bgA), transparent 60%),
        radial-gradient(900px 420px at 90% 0%, var(--bgB), transparent 60%),
        radial-gradient(900px 420px at 50% 10%, var(--bgC), transparent 62%),
        linear-gradient(180deg,#ffffff,var(--bgD));
      color:var(--ink);
    }

    header{padding:18px 16px 10px;max-width:1180px;margin:0 auto}
    h1{margin:0 0 6px;font-size:22px}
    p{margin:0 0 10px;color:var(--muted);line-height:1.45}

    .wrap{max-width:1180px;margin:0 auto;padding:0 16px 28px;display:grid;gap:14px}
    .grid-2{display:grid;gap:14px}
    @media(min-width:980px){ .grid-2{grid-template-columns:1fr 1fr} }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      position:relative;
    }

    .card::before{
      content:"";
      position:absolute; left:0; right:0; top:0; height:5px;
      background:linear-gradient(90deg,var(--accent),var(--accent2),var(--accent3),var(--accent4));
    }

    .card h2{margin:0;padding:16px 14px 0;font-size:17px}
    .card .sub{padding:6px 14px 12px;color:var(--muted);font-size:13px}

    .controls{
      display:flex;flex-wrap:wrap;gap:10px;align-items:center;
      padding:12px 14px 14px;border-top:1px solid var(--line);
      background:linear-gradient(180deg,#ffffff,#f6f8ff);
    }

    button{
      border:1px solid rgba(37,99,235,.25);
      background:linear-gradient(180deg,#ffffff,#f1f6ff);
      color:var(--ink);
      padding:8px 10px;
      border-radius:12px;
      cursor:pointer;
      box-shadow: 0 6px 14px rgba(37,99,235,.14);
      font-weight:650;
    }
    button:hover{border-color:rgba(37,99,235,.55)}
    button.danger{
      border-color:rgba(239,68,68,.28);
      background:linear-gradient(180deg,#ffffff,#fff1f2);
      box-shadow: 0 6px 14px rgba(239,68,68,.12);
    }
    button.danger:hover{border-color:rgba(239,68,68,.58)}

    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;border:1px solid var(--line);
      color:var(--muted);font-size:13px;
      background:linear-gradient(180deg,#ffffff,#fbfdff);
    }
    .dot{width:8px;height:8px;border-radius:50%}
    .dot.ok{background:var(--good)}
    .dot.na{background:var(--warn)}

    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 10px;border-top:1px solid var(--line);vertical-align:middle}
    th{
      font-size:12px;color:var(--muted);text-align:left;
      font-weight:750;letter-spacing:.02em;background:#f6f8ff;
    }

    .schedule td{font-size:14px}
    .time{white-space:nowrap;color:var(--muted);font-variant-numeric:tabular-nums}
    .match{font-weight:900}
    .field{color:var(--muted);font-size:12px;margin-top:1px}

    .row-current{
      background:linear-gradient(90deg, rgba(37,99,235,.16), rgba(124,58,237,.12), rgba(249,115,22,.10), rgba(6,182,212,.10));
      box-shadow: inset 3px 0 0 rgba(37,99,235,.55);
    }
    .row-played{background:rgba(2,6,23,.018)}
    .row-current .match{color:#1036c8}

    .score{display:flex;align-items:center;gap:8px}

    input.scorebox{
      width:98px;
      background:#ffffff;
      border:1px solid var(--line);
      color:var(--ink);
      border-radius:12px;
      padding:8px 10px;
      font-size:15px;
      font-variant-numeric:tabular-nums;
      outline:none;
    }
    input.scorebox:focus{
      border-color:rgba(37,99,235,.60);
      box-shadow: 0 0 0 4px rgba(37,99,235,.16);
    }
    input.scorebox::placeholder{color:rgba(15,23,42,.25)}
    .sep{color:var(--muted);font-weight:750}

    .status{font-size:12px;color:var(--muted);font-weight:750}
    .status.good{color:var(--good)}
    .status.warn{color:var(--warn)}
    .status.bad{color:var(--bad)}
    .status.current{color:var(--accent)}

    .standings th,.standings td{font-size:13px}
    .standings td.num{text-align:right;font-variant-numeric:tabular-nums}
    .standings td.team{font-weight:950}

    .hint{padding:10px 14px 14px;color:var(--muted);font-size:13px;line-height:1.45;background:#fff}
    .footer{max-width:1180px;margin:0 auto;padding:0 16px 24px;color:var(--muted);font-size:12px}
    code{background:#eef2ff;border:1px solid var(--line);border-radius:8px;padding:2px 6px}
  </style>

  <!-- PWA / App -->
  <meta name="theme-color" content="#2563eb" />
  <meta name="application-name" content="Basketballturnier" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Basketballturnier" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" sizes="192x192" href="icons/icon-192.png" />
  <link rel="icon" sizes="512x512" href="icons/icon-512.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

</head>
<body>
<header>
  <h1>Basketballturnier – Ergebnisse eingeben</h1>
  <p>Jungen und Mädchen werden <b>getrennt</b> gewertet. Pro Spiel: Sieg = <b>2 Punkte</b>, Unentschieden = <b>1 Punkt</b> je Team, Niederlage = <b>0 Punkte</b>. Eingaben werden automatisch lokal gespeichert (LocalStorage).</p>
</header>

<div class="wrap">
  <div class="grid-2">
    <section class="card">
      <h2>Spielplan – Jungen (Feld 1)</h2>
      <div class="sub">Teams: A, B, C, D, E • <b>Aktuelles Spiel</b> ist farbig markiert</div>
      <table class="schedule" id="schedule-boys">
        <thead>
          <tr>
            <th style="width:90px">Uhrzeit</th>
            <th>Spiel</th>
            <th style="width:280px">Ergebnis</th>
            <th style="width:140px">Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="controls">
        <span class="pill"><span class="dot ok"></span>gespielt: <span id="played-boys">0</span></span>
        <span class="pill"><span class="dot na"></span>offen: <span id="open-boys">0</span></span>
        <button class="danger" id="reset-boys">Jungen zurücksetzen</button>
      </div>
    </section>

    <section class="card">
      <h2>Spielplan – Mädchen (Feld 2)</h2>
      <div class="sub">Teams: A, B, C, D, E • <b>Aktuelles Spiel</b> ist farbig markiert</div>
      <table class="schedule" id="schedule-girls">
        <thead>
          <tr>
            <th style="width:90px">Uhrzeit</th>
            <th>Spiel</th>
            <th style="width:280px">Ergebnis</th>
            <th style="width:140px">Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class="controls">
        <span class="pill"><span class="dot ok"></span>gespielt: <span id="played-girls">0</span></span>
        <span class="pill"><span class="dot na"></span>offen: <span id="open-girls">0</span></span>
        <button class="danger" id="reset-girls">Mädchen zurücksetzen</button>
      </div>
    </section>
  </div>

  <div class="grid-2">
    <section class="card">
      <h2>Tabelle – Jungen</h2>
      <div class="sub">Sortierung: Punkte ↓, Korbdifferenz ↓, Körbe ↓</div>
      <table class="standings" id="standings-boys">
        <thead>
          <tr>
            <th>Team</th>
            <th class="num">Sp</th>
            <th class="num">S</th>
            <th class="num">U</th>
            <th class="num">N</th>
            <th class="num">K+</th>
            <th class="num">K-</th>
            <th class="num">Diff</th>
            <th class="num">P</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
</section>

    <section class="card">
      <h2>Tabelle – Mädchen</h2>
      <div class="sub">Sortierung: Punkte ↓, Korbdifferenz ↓, Körbe ↓</div>
      <table class="standings" id="standings-girls">
        <thead>
          <tr>
            <th>Team</th>
            <th class="num">Sp</th>
            <th class="num">S</th>
            <th class="num">U</th>
            <th class="num">N</th>
            <th class="num">K+</th>
            <th class="num">K-</th>
            <th class="num">Diff</th>
            <th class="num">P</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
</section>
  </div>
</div>

<div class="footer">
  <div>Produkt: Lisa Klostermann © 2026</div>
</div>

<script>
  const RESET_PASSWORD = "1234567";

  const TEAMS = ["A","B","C","D","E"];
  const SCHEDULE = [
    { time: "9:15",  a: "A", b: "B" },
    { time: "9:30",  a: "C", b: "D" },
    { time: "9:45",  a: "A", b: "E" },
    { time: "10:45", a: "B", b: "C" },
    { time: "11:00", a: "D", b: "E" },
    { time: "11:15", a: "A", b: "C" },
    { time: "11:30", a: "B", b: "D" },
    { time: "11:45", a: "C", b: "E" },
    { time: "12:00", a: "A", b: "D" },
    { time: "12:15", a: "B", b: "E" },
  ];

  const $ = (sel, root=document) => root.querySelector(sel);
  const el = (tag, attrs={}, ...children) => {
    const n = document.createElement(tag);
    for (const [k,v] of Object.entries(attrs)) {
      if (k === "class") n.className = v;
      else if (k === "dataset") Object.assign(n.dataset, v);
      else if (k.startsWith("on") && typeof v === "function") n.addEventListener(k.substring(2), v);
      else n.setAttribute(k, v);
    }
    for (const c of children) n.append(c?.nodeType ? c : document.createTextNode(String(c)));
    return n;
  };

  function storageKey(group){ return `bbtour_${group}_v3`; }

  function loadScores(group){
    try{
      const raw = localStorage.getItem(storageKey(group));
      return raw ? JSON.parse(raw) : {};
    }catch(e){ return {}; }
  }
  function saveScores(group, scores){
    localStorage.setItem(storageKey(group), JSON.stringify(scores));
  }

  function isPlayed(s){ return Number.isFinite(s?.sa) && Number.isFinite(s?.sb); }

  function sanitizeDigits(str){ return (str || "").replace(/[^\d]/g, ""); }
  function parseScore(str){
    const s = sanitizeDigits(str);
    if (s === "") return undefined;
    const n = Number(s);
    return Number.isFinite(n) ? n : undefined;
  }

  function computeStandings(scores){
    const table = {};
    for (const t of TEAMS){
      table[t] = { team:t, gp:0, w:0, d:0, l:0, pf:0, pa:0, pts:0 };
    }
    for (let i=0;i<SCHEDULE.length;i++){
      const match = SCHEDULE[i];
      const key = String(i);
      const s = scores[key];
      if (!isPlayed(s)) continue;

      const sa = s.sa, sb = s.sb;
      const A = match.a, B = match.b;

      table[A].gp++; table[B].gp++;
      table[A].pf += sa; table[A].pa += sb;
      table[B].pf += sb; table[B].pa += sa;

      if (sa > sb){
        table[A].w++; table[B].l++;
        table[A].pts += 2;
      } else if (sb > sa){
        table[B].w++; table[A].l++;
        table[B].pts += 2;
      } else {
        table[A].d++; table[B].d++;
        table[A].pts += 1; table[B].pts += 1;
      }
    }
    const arr = Object.values(table).map(r => ({...r, diff: r.pf - r.pa}));
    arr.sort((x,y) =>
      (y.pts - x.pts) ||
      (y.diff - x.diff) ||
      (y.pf - x.pf) ||
      (x.team.localeCompare(y.team))
    );
    return arr;
  }

  function firstOpenIndex(scores){
    for (let i=0;i<SCHEDULE.length;i++){
      const s = scores[String(i)];
      if (!isPlayed(s)) return i;
    }
    return -1;
  }

  function statusText(match, score, isCurrent){
    if (!isPlayed(score) && isCurrent) return { text: "aktuell", cls: "current" };
    if (!isPlayed(score)) return { text: "offen", cls: "warn" };
    if (score.sa > score.sb) return { text: `${match.a} gewinnt`, cls: "good" };
    if (score.sb > score.sa) return { text: `${match.b} gewinnt`, cls: "good" };
    return { text: "unentschieden", cls: "warn" };
  }

  function captureActive(group){
    const a = document.activeElement;
    if (!a || !a.dataset) return null;
    if (a.dataset.group !== group) return null;
    return { group, key: a.dataset.key, side: a.dataset.side, start: a.selectionStart, end: a.selectionEnd };
  }

  function restoreActive(info){
    if (!info) return;
    const q = `input[data-group="${info.group}"][data-key="${info.key}"][data-side="${info.side}"]`;
    const inp = document.querySelector(q);
    if (!inp) return;
    inp.focus();
    if (typeof info.start === "number" && typeof info.end === "number" && inp.setSelectionRange){
      const len = inp.value.length;
      inp.setSelectionRange(Math.min(info.start,len), Math.min(info.end,len));
    }
  }

  function requestReset(group){
    const label = group==="boys" ? "Jungen" : "Mädchen";
    const pw = prompt(`Passwort eingeben, um ${label} zu löschen:`);
    if (pw === null) return;
    if (pw !== RESET_PASSWORD){
      alert("Falsches Passwort – Löschen nicht erlaubt.");
      return;
    }
    localStorage.removeItem(storageKey(group));
    renderGroup(group);
  }

  function renderGroup(group){
    const activeInfo = captureActive(group);
    const scores = loadScores(group);
    const currentIdx = firstOpenIndex(scores);

    const schedBody = $(`#schedule-${group} tbody`);
    schedBody.innerHTML = "";
    let playedCount = 0;

    SCHEDULE.forEach((m, idx) => {
      const key = String(idx);
      const s = scores[key] || {};
      const played = isPlayed(s);
      if (played) playedCount++;

      const rowClass = (idx === currentIdx) ? "row-current" : (played ? "row-played" : "");

      const inputA = el("input", {
        class:"scorebox",
        type:"text",
        inputmode:"numeric",
        autocomplete:"off",
        placeholder:"0",
        value: Number.isFinite(s.sa) ? String(s.sa) : "",
        dataset: { group, key, side:"a" },
        oninput: () => {
          const cleaned = sanitizeDigits(inputA.value);
          if (cleaned !== inputA.value){
            const pos = inputA.selectionStart ?? cleaned.length;
            inputA.value = cleaned;
            inputA.setSelectionRange(Math.min(pos, cleaned.length), Math.min(pos, cleaned.length));
          }
          scores[key] = scores[key] || {};
          scores[key].sa = parseScore(inputA.value);
          saveScores(group, scores);
          renderGroup(group);
        }
      });

      const inputB = el("input", {
        class:"scorebox",
        type:"text",
        inputmode:"numeric",
        autocomplete:"off",
        placeholder:"0",
        value: Number.isFinite(s.sb) ? String(s.sb) : "",
        dataset: { group, key, side:"b" },
        oninput: () => {
          const cleaned = sanitizeDigits(inputB.value);
          if (cleaned !== inputB.value){
            const pos = inputB.selectionStart ?? cleaned.length;
            inputB.value = cleaned;
            inputB.setSelectionRange(Math.min(pos, cleaned.length), Math.min(pos, cleaned.length));
          }
          scores[key] = scores[key] || {};
          scores[key].sb = parseScore(inputB.value);
          saveScores(group, scores);
          renderGroup(group);
        }
      });

      const st = statusText(m, s, idx === currentIdx);

      schedBody.append(
        el("tr", { class: rowClass },
          el("td", {class:"time"}, m.time),
          el("td", {},
            el("div", {class:"match"}, `${m.a} – ${m.b}`),
            el("div", {class:"field"}, group==="boys" ? "Feld 1" : "Feld 2")
          ),
          el("td", {}, el("div", {class:"score"}, inputA, el("span", {class:"sep"}, ":"), inputB)),
          el("td", {}, el("span", {class:`status ${st.cls}`}, st.text))
        )
      );
    });

    $(`#played-${group}`).textContent = playedCount;
    $(`#open-${group}`).textContent = (SCHEDULE.length - playedCount);

    const standings = computeStandings(scores);
    const standBody = $(`#standings-${group} tbody`);
    standBody.innerHTML = "";
    for (const r of standings){
      standBody.append(
        el("tr", {},
          el("td", {class:"team"}, r.team),
          el("td", {class:"num"}, r.gp),
          el("td", {class:"num"}, r.w),
          el("td", {class:"num"}, r.d),
          el("td", {class:"num"}, r.l),
          el("td", {class:"num"}, r.pf),
          el("td", {class:"num"}, r.pa),
          el("td", {class:"num"}, r.diff),
          el("td", {class:"num"}, r.pts)
        )
      );
    }

    $(`#reset-${group}`).onclick = () => requestReset(group);
    restoreActive(activeInfo);
  }

  renderGroup("boys");
  renderGroup("girls");
</script>

<script>
  // PWA: Service Worker registrieren (offline & installierbar)
  if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
      navigator.serviceWorker.register("./sw.js").catch(() => {});
    });
  }
</script>

</body>
</html>
